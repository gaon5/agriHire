{% extends 'staff/manage_base.html' %}

<!--Update Equipment-->

{% block inside_title %}

{% endblock %}


{% block inside_css %}
    <style>
        .relative {
            position: relative;
        }

        .asterisk {
            color: red;
            position: absolute;
            top: 10px; /* Center vertically */
            left: 10px; /* Distance from the left edge of the input box. Adjust as needed */
            transform: translateY(-50%); /* Centering adjustment */
            pointer-events: none; /* Ensure clicks 'pass through' to the input element */
        }

        .asterisk-inside {
            padding-left: 20px; /* Adjust as needed */
        }
    </style>
{% endblock %}

{% block inside_body %}
<div class="">
    <div class="row justify-content-center my-5">
        <div class="col-lg-8">
            {% for item in equipment %}
                <form action="{{ url_for('update_equipment', detail_id = item['equipment_id']) }}" method="POST" enctype="multipart/form-data" id="myForm1">
                    <!-- Hidden Field -->
                    <input type="hidden" name="equipment_id" id="equipment_id" value="{{ item.equipment_id }}"/>
                    <div class="col-md-3 mt-3">
                        <!-- Current Image(s) -->
                        {% if item.image_urls %}
                            <!-- Check if there's a main image (priority 1) and display it with the label -->
                            {% set main_image_shown = false %}
                            {% for pic in image_priority %}
                                {% if pic.priority == 1 and not main_image_shown %}
                                    <div class="card">
                                        <img src="{{ url_for('static', filename=pic.image_url) }}" alt="{{item.image_id}}" data-value="{{ item.image_id }}" class="card_img_top" height="200" width="200">
                                    </div>
                                    {% set main_image_shown = true %}
                                {% endif %}
                            {% endfor %}
                            <!-- Display other images (priority != 1) -->
                            {% for pic in image_priority %}
                                {% if pic.priority != 1 %}
                                    <div class="card">
                                        <img src="{{ url_for('static', filename=pic.image_url) }}" alt="{{item.image_id}}" data-value="{{ item.image_id }}" class="card_img_top" height="200" width="200">
                                    </div>
                                {% endif %}
                            {% endfor %}
                        {% endif %}
                    </div>
                    <!-- Main Image -->
                    <div class="relative mb-3">
                        <label for="mainimage" class="asterisk mt-2"><span style="color:red">*</span></label>
                        <input type="file" class="form-control asterisk-inside" name="mainimage" id="mainimage" accept="image/*">
                    </div>
                    <!-- Image -->
                    <div class="relative mb-3">
                        <label for="image" class="asterisk mt-2"></label>
                        <input type="file" class="form-control asterisk-inside" name="image" id="image" accept="image/*">
                    </div>
                    <!-- Equipment Name -->
                    <div class="relative mb-3">
                        <label for="ename" class="asterisk mt-2"><span style="color:red">*</span></label>
                        <input type="text" class="form-control asterisk-inside" name="ename" id="ename" value="{{ item.e_name }}" placeholder="Enter Equipment Name">
                    </div>
                    <!-- Category -->
                    <div class="relative mb-3">
                        <label for="category" class="asterisk mt-2"><span style="color:red">*</span></label>
                        <select class="form-control asterisk-inside" name="category" id="category">
                            {% for category in main %}
                                <option value="{{ category.category_id }}" {% if category.category_id == item.category_id %}selected{% endif %}>
                                    {{ category.name }}
                                </option>
                            {% endfor %}
                        </select>
                    </div>
                    <!-- Sub-Category -->
                    <div class="relative mb-3">
                        <label for="sub_category" class="asterisk mt-2"><span style="color:red">*</span></label>
                        <select class="form-control asterisk-inside" name="sub_category" id="sub_category">
                            {% for category in sub %}
                            <option value="{{ category.sub_id }}" {% if category.sub_id == item.sub_id %}selected{% endif %}>{{ category.name }}</option>
                            {% endfor %}
                        </select>
                    </div> 
                    <!-- Price -->
                    <div class="relative mb-3">
                        <label for="price" class="asterisk mt-2"><span style="color:red">*</span></label>
                        <input type="number" class="form-control asterisk-inside" name="price" id="price" value="{{ item.price }}" autocomplete="off" placeholder="Enter Price">
                    </div>
                    <!-- Stock -->
                    <div class="relative mb-3">
                        <label for="stock" class="asterisk mt-2"><span style="color:red">*</span></label>
                        <input type="number" class="form-control asterisk-inside" name="stock" id="stock" value="{{ item.count }}" autocomplete="off" placeholder="Enter Stock">
                    </div>
                    <!-- Min Threshold -->
                    <div class="relative mb-3">
                        <label for="min" class="asterisk mt-2"><span style="color:red">*</span></label>
                        <input type="number" class="form-control asterisk-inside" name="min" id="min" value="{{item.min_stock_threshold}}" autocomplete="off" placeholder="Enter minumum stock threshold">
                    </div>
                    <!-- License -->
                    <div class="relative mb-3">
                        <label for="license" class="asterisk mt-2"><span style="color:red">*</span></label>
                        <select class="form-control asterisk-inside" name="license" id="license">
                            <option value="yes" {% if item['requires_drive_license'] == 1 %}selected {% endif %}>Yes</option>
                            <option value="no" {% if item['requires_drive_license'] == 0 %}selected {% endif %}>No</option>
                        </select>
                    </div>
                    <!-- Length -->
                    <div class="relative mb-3">
                        <label for="length" class="asterisk mt-2"><span style="color:red">*</span></label>
                        <input type="number" class="form-control asterisk-inside" name="length" id="length" value="{{ item.length }}" autocomplete="off" pattern="^\d+(\.\d+)?$" placeholder="Enter Length (CM)">
                    </div>
                    <!-- Width -->
                    <div class="relative mb-3">
                        <label for="width" class="asterisk mt-2"><span style="color:red">*</span></label>
                        <input type="number" class="form-control asterisk-inside" name="width" id="width" value="{{ item.width }}" autocomplete="off" placeholder="Enter Width (CM)">
                    </div>
                    <!-- Height -->
                    <div class="relative mb-3">
                        <label for="height" class="asterisk mt-2"><span style="color:red">*</span></label>
                        <input type="number" class="form-control asterisk-inside" name="height" id="height" value="{{ item.height }}" autocomplete="off" placeholder="Enter Height (CM)">
                    </div>
                    <!-- Description -->
                    <div class="relative mb-3">
                        <label for="description" class="asterisk mt-2"><span style="color:red">*</span></label>
                        <textarea id="description" class="form-control asterisk-inside" name="description" rows="5" placeholder="Enter Description">{{ item.description }}</textarea>
                    </div>
                    <!-- Detail -->
                    <div class="relative mb-3">
                        <label for="detail" class="asterisk mt-2"><span style="color:red">*</span></label>
                        <textarea id="detail" class="form-control asterisk-inside" name="detail" rows="5" placeholder="Enter Detail">{{ item.detail }}</textarea>
                    </div>
                    <!-- Submit Button -->
                    <div class="d-grid gap-2">
                        <input type="submit" class="btn btn-warning" value="Update">
                    </div>
                </form>
                {% endfor %}
            </div>
        </div>
    </div>
{% endblock %}

{% block inside_js %}
    <script>
        $("#myForm1").validate({
            rules: {
                ename: "required",
                price: "required",
                stock: {
                    required: true
                },
                length: "required",
                width: "required",
                height: "required",
                description: "required",
                detail: "required",
            },
            errorElement: 'div',
            errorPlacement: function (error, element) {
                error.addClass('text-danger');
                error.insertAfter(element);
                element.addClass('is-invalid');
            },
            success: function (label, element) {
                $(element).removeClass('is-invalid');
            }
        });
        $('#myForm1').on('submit', function (event) {
            event.preventDefault();
            if ($(this).valid()) {
                document.getElementById("myForm1").submit();
            }
        });
    </script>
{% endblock %}